<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Book Flight | CloudSky</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Josefin+Sans:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0; padding: 0;
      font-family: 'Josefin Sans', sans-serif;
      color: white;
      overflow: hidden;
    }
    ::-webkit-scrollbar { width: 0; background: transparent; }
    #vanta-bg {
      position: fixed;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      z-index: -2;
    }
    #overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.65);
      z-index: -1;
    }
    .booking-wrapper {
      display: flex; justify-content: center; align-items: flex-start;
      min-height: 100vh; padding: 30px 0; overflow-y: auto; width: 100%;
    }
    .booking-container {
      background: rgba(255, 255, 255, 0.08);
      max-width: 700px; width: 100%; margin: 10 auto; padding: 30px;
      border-radius: 15px; box-shadow: 0 0 20px rgba(0,0,0,0.6);
      max-height: 90vh; overflow-y: auto; backdrop-filter: blur(15px);
    }
    h1 { text-align: center; color: #bcbdbd; margin-bottom: 30px; }
    .form-group { margin-bottom: 20px; }
    label { display: block; margin-bottom: 8px; font-weight: 600; }
    input {
      width: 97%; padding: 12px;
      border-radius: 5px; border: none;
      background: rgba(255,255,255,0.9);
      font-size: 16px;
    }
    .seat-grid { margin-top: 25px; text-align: center; }
    .row { display: flex; justify-content: center; margin-bottom: 5px; }
    .seat {
      width: 40px; height: 40px; margin: 5px;
      border-radius: 6px; line-height: 40px; text-align: center;
      font-weight: bold; background: #e4ebee; color: black;
      cursor: pointer; transition: 0.3s;
    }
    .seat.selected { background: #99e779; border: 2px solid white; }
    .seat.booked { background: #f76d6d; color: white; cursor: not-allowed; pointer-events: none; }
    .payment-section { margin-top: 30px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.2); }
    .payment-section h3 { color: #e6eaec; }
    button {
      background: #3c3e3f; color: white; padding: 14px;
      border: none; border-radius: 10px; cursor: pointer;
      font-weight: bold; font-size: 16px; width: 100%;
      margin-top: 20px; transition: all 0.3s;
    }
    button:hover { background: #b9f397; transform: translateY(-2px); }
    .owner-credit {
      position: fixed; bottom: 15px; right: 15px;
      background: rgba(0, 0, 0, 0.7); padding: 8px 15px;
      border-radius: 20px; font-size: 14px; font-weight: 500;
      box-shadow: 0 0 10px rgba(0,0,0,0.5);
    }
    .user-area { position: absolute; top: 16px; right: 16px; z-index: 50; }
    .user-btn {
      background: rgba(2,136,209,0.9); border-radius: 24px;
      width:44px; height:44px; display:flex;
      align-items:center; justify-content:center;
      cursor:pointer; color:white; font-weight:700;
    }
    .user-dropdown {
      display:none; position: absolute; right:0; top:56px;
      background: rgba(0,0,0,0.85); color: #fff; width:320px;
      border-radius:8px; box-shadow: 0 6px 18px rgba(0,0,0,0.5); padding:12px;
    }
    /* Admin Icon - Bottom Left */
    .admin-icon {
      position: fixed;
      bottom: 15px;
      left: 15px;
      width: 40px;
      height: 40px;
      background: rgba(14, 13, 13, 0.9);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 100;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(0,0,0,0.5);
    }
    .admin-icon:hover {
      background: rgb(7, 7, 7);
      transform: scale(1.1);
    }
    .admin-icon svg {
      width: 28px;
      height: 28px;
      fill: white;
    }
    @media (max-width: 768px) {
      .booking-wrapper { padding: 10px 0; min-height: unset;}
      .booking-container { padding: 12px; max-width: 99vw; }
      h1 { font-size:1.2rem; margin-bottom:12px; }
      .seat { width:30px; height:30px; line-height:30px; font-size:12px;}
      .user-area { top:6px; right:6px; }
      .user-btn { width:32px; height:32px;}
      .user-dropdown { width:90vw;}
      .admin-icon { width:42px; height:42px; left:8px; bottom:8px;}
      .owner-credit { font-size:10px; padding:4px 8px; }
    }
    @media (min-width: 769px) and (max-width: 1024px) {
      .admin-icon { width:46px; height:46px;}
    }
  </style>
</head>
<body>

  <!-- Vanta Background -->
  <div id="vanta-bg"></div>
  <div id="overlay"></div>

  <div class="user-area">
    <div class="user-btn" id="userBtn">
        {% if current_user %}
            {{ current_user.full_name[0]|upper }}
        {% else %}
            U
        {% endif %}
    </div>
    <div class="user-dropdown" id="userDropdown">
        {% if current_user %}
            <h4>{{ current_user.full_name }}</h4>
            <div class="info">
                <div><strong>Email:</strong> {{ current_user.email }}</div>
            </div>
            <div><strong>Your Bookings</strong></div>
            <div class="bookings">
                {% if current_user_bookings %}
                    {% for b in current_user_bookings %}
                        <div class="book">
                            <div><strong>{{ b.flight_no }}</strong> | {{ b.origin }} â†’ {{ b.destination }}</div>
                            <div>Seat: {{ b.seat_number or 'N/A' }} | Ref: {{ b.booking_ref }}</div>
                        </div>
                    {% endfor %}
                {% else %}
                    <div class="book">No bookings yet</div>
                {% endif %}
            </div>
            <a href="{{ url_for('logout') }}">Logout</a>
        {% else %}
            <a href="{{ url_for('login') }}" style="display:block; margin-bottom:8px;">Login</a>
            <a href="{{ url_for('register') }}">Register</a>
        {% endif %}
    </div>
  </div>

  <!-- Admin Icon - Bottom Left -->
  <a href="{{ url_for('admin_login') }}" class="admin-icon" title="Admin Login">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
      <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/>
    </svg>
  </a>

  <div class="booking-wrapper">
    <div class="booking-container">
      <h1>Complete Your Booking</h1>
      <form method="POST">
        <div class="form-group">
          <label>Full Name</label>
          <input type="text" name="full_name" required>
        </div>
        <div class="form-group">
          <label>Email Address</label>
          <input type="email" name="email" required>
        </div>
        <div class="form-group">
          <label>Phone Number</label>
          <input type="tel" name="phone" required>
        </div>
        <div class="form-group">
          <label>Passport Number</label>
          <input type="text" name="passport" 
            required 
            pattern="[0-9]{8}" 
            maxlength="8" 
            title="Passport number must be exactly 8 digits">
        </div>

        <h3 style="margin-top: 30px; color: #f5f7f8;">Select Your Seat</h3>
        <div class="seat-grid">
          {% for row in range(1, 5) %}
            <div class="row">
              {% for col in range(1, 7) %}
                {% set seat = 'R' ~ row ~ 'C' ~ col %}
                <div class="seat {% if seat in booked_seats %}booked{% endif %} {% if seat == selected_seat %}selected{% endif %}" data-seat="{{ seat }}">{{ seat }}</div>
              {% endfor %}
            </div>
          {% endfor %}
        </div>
        <input type="hidden" name="selected_seat" id="selected_seat">

        <div class="payment-section">
          <h3>Payment Information</h3>
          <div class="form-group">
            <label>Card Number</label>
            <input type="text" 
                   name="card_number"
                   inputmode="numeric"
                   pattern="[0-9]+"
                   placeholder="1234567812345678"
                   title="Card number must contain digits only"
                   required>
          </div>
          <div class="form-group">
            <label>Expiry Date</label>
            <input type="text"
                   name="expiry"
                   pattern="(0[1-9]|1[0-2])\/[0-9]{2}" 
                   placeholder="MM/YY" 
                   title="Format must be MM/YY (e.g., 08/25)"
                   required>
          </div>
          <div class="form-group">
            <label>CVV</label>
            <input type="text"
                   name="cvv"
                   pattern="[0-9]{3}"
                   maxlength="3"
                   placeholder="123"
                   title="CVV must be exactly 3 digits"
                   required>
          </div>
        </div>

        <button type="submit">Confirm Booking</button>
      </form>
    </div>
  </div>

  <div class="owner-credit">Developed by Harishwar S 
    Suhas J </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r121/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vanta/dist/vanta.waves.min.js"></script>
  <script>
    VANTA.WAVES({
      el: "#vanta-bg",
      mouseControls: true,
      touchControls: true,
      gyroControls: false,
      minHeight: 200.00,
      minWidth: 100.00,
      scale: 1.00,
      scaleMobile: 1.00,
      color: 0x000000,
      shininess: 100.50,
      waveHeight: 0.00,
      waveSpeed: 0.00,
      zoom: 1.50
    });

    // Seat selection
    const seats = document.querySelectorAll('.seat:not(.booked)');
    const seatInput = document.getElementById('selected_seat');
    seats.forEach(seat => {
      seat.addEventListener('click', () => {
        seats.forEach(s => s.classList.remove('selected'));
        seat.classList.add('selected');
        seatInput.value = seat.getAttribute('data-seat');
      });
    });

    // Dropdown toggle
    const userBtn = document.getElementById('userBtn');
    const dropdown = document.getElementById('userDropdown');
    userBtn.addEventListener('click', () => {
      dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
    });
    window.addEventListener('click', function(e){ 
      if(!userBtn.contains(e.target) && !dropdown.contains(e.target)){ 
        dropdown.style.display = 'none'; 
      }
    });
  </script>

</body>
</html>
