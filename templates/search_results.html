<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Search Results | CloudSky</title>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Josefin+Sans:wght@400;600;700&display=swap" rel="stylesheet"/>
  <style>
    body { margin:0; font-family:'Josefin Sans',sans-serif; color:white; background:#000; overflow-x:hidden;}
    #vanta-bg { position:fixed; top:0; left:0; width:100%; height:100%; z-index:-1; }
    .container { padding:20px; max-width:1100px; margin:auto; background:rgba(0,0,0,0.75); border-radius:12px; margin-top:40px; box-shadow:0 0 20px rgba(0,0,0,0.6);}
    h1 { text-align:center; margin-bottom:30px; }
    table { width:100%; border-collapse:collapse; background:rgba(255,255,255,0.05); border-radius:10px; overflow:hidden;}
    th,td { padding:14px; text-align:center; }
    th { background:linear-gradient(to right,#66c9f7,#4a4a4b); color:white; font-size:1rem; }
    tr:nth-child(even) { background:rgba(255,255,255,0.03); }
    tr:hover { background:rgba(255,255,255,0.1); transition:background 0.3s ease; }
    a.book-btn { display:inline-block; padding:8px 12px; background:#3c3e3f; color:white; border-radius:6px; text-decoration:none; font-weight:bold; transition:all 0.3s; }
    a.book-btn:hover { background:#66c9f7; color:black; transform:translateY(-2px); }
    .no-results { text-align:center; margin-top:40px; font-size:1.2rem; }
    .user-area { position:absolute; top:16px; right:16px; }
    .user-btn { background:rgba(2,136,209,0.9); border-radius:24px; width:44px; height:44px; display:flex; align-items:center; justify-content:center; cursor:pointer; }
    .user-dropdown { display:none; position:absolute; right:0; top:56px; background:rgba(0,0,0,0.85); width:320px; border-radius:8px; padding:12px; }
    .user-dropdown a { color:#66c9f7; text-decoration:none; display:block; margin:8px 0; }

    /* Admin Icon - Bottom Left */
    .admin-icon {
      position: fixed;
      bottom: 15px;
      left: 15px;
      width: 50px;
      height: 50px;
      background: rgba(10, 10, 10, 0.9);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 100;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(0,0,0,0.5);
    }
    .admin-icon:hover {
      background: rgb(12, 12, 12);
      transform: scale(1.1);
    }
    .admin-icon svg {
      width: 28px;
      height: 28px;
      fill: white;
    }
    .owner-credit {
      position: fixed;
      bottom: 10px;
      right: 10px;
      background: rgba(0,0,0,0.7);
      padding: 5px 10px;
      border-radius: 5px;
      font-size: 12px;
    }
    /* Responsive Design */
    @media (max-width: 768px) {
      .container { padding:10px; max-width:98vw; margin-top:10px;}
      h1 { font-size:1.4rem; margin-bottom:15px;}
      th,td { padding:7px; font-size:0.95rem; }
      .user-area { top:6px; right:6px;}
      .user-btn { width:32px; height:32px; }
      .user-dropdown { width:90vw; }
      .admin-icon { width:42px; height:42px; left:8px; bottom:8px;}
      .owner-credit { font-size:10px; padding: 4px 8px; }
    }
    @media (min-width: 769px) and (max-width: 1024px) {
      .container { max-width:92vw;}
      .admin-icon { width:46px; height:46px;}
    }
  </style>
</head>
<body>

<div class="user-area">
  <div class="user-btn" id="userBtn">
    {% if current_user %}
      {{ current_user.full_name[0]|upper }}
    {% else %}
      U
    {% endif %}
  </div>
  <div class="user-dropdown" id="userDropdown">
    {% if current_user %}
      <h4>{{ current_user.full_name }}</h4>
      <div><strong>Email:</strong> {{ current_user.email }}</div>
      <strong>Your Bookings</strong>
      {% if current_user_bookings %}
        {% for b in current_user_bookings %}
          <div>{{ b.flight_no }} | {{ b.origin }} â†’ {{ b.destination }} ({{ b.seat_number or 'N/A' }})</div>
        {% endfor %}
      {% else %}
        <div>No bookings yet</div>
      {% endif %}
      <a href="{{ url_for('logout') }}">Logout</a>
    {% else %}
      <a href="{{ url_for('login') }}">Login</a>
      <a href="{{ url_for('register') }}">Register</a>
    {% endif %}
  </div>
</div>

<!-- Admin Icon - Bottom Left -->
<a href="{{ url_for('admin_login') }}" class="admin-icon" title="Admin Login">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/>
  </svg>
</a>

<div id="vanta-bg"></div>

<div class="container">
  <h1>Available Flights</h1>
  {% if flights %}
  <table>
    <thead>
      <tr>
        <th>Flight No</th>
        <th>Origin</th>
        <th>Destination</th>
        <th>Departure</th>
        <th>Price</th>
        <th>Seats</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      {% for flight in flights %}
      <tr>
        <td>{{ flight.flight_no }}</td>
        <td>{{ flight.origin }}</td>
        <td>{{ flight.destination }}</td>
        <td>{{ flight.departure }}</td>
        <td>${{ flight.price }}</td>
        <td>{{ flight.seats }}</td>
        <td><a class="book-btn" href="{{ url_for('book', flight_id=flight.id) }}">Book</a></td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <div class="no-results">No flights found for your search.</div>
  {% endif %}
</div>

<div class="owner-credit">Developed by Harishwar S and Suhas J</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r121/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vanta/dist/vanta.waves.min.js"></script>
<script>
VANTA.WAVES({
                el: "#vanta-bg",
                mouseControls: true,
                touchControls: true,
                gyroControls: false,
                minHeight: 200.00,
                minWidth: 200.00,
                scale: 1.00,
                scaleMobile: 1.00,
                color: 0x0,
                shininess: 100.20,
                waveHeight: 0.00,
                waveSpeed: 0.00,
                zoom: 1.50
            });
const userBtn=document.getElementById('userBtn'),dropdown=document.getElementById('userDropdown');
userBtn.addEventListener('click',()=>dropdown.style.display=dropdown.style.display==='block'?'none':'block');
window.addEventListener('click',e=>{if(!userBtn.contains(e.target)&&!dropdown.contains(e.target))dropdown.style.display='none';});
</script>
</body>
</html>
